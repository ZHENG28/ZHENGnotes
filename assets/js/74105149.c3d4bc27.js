"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[242],{6785:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>i,metadata:()=>d,toc:()=>t});var l=s(4848),r=s(8453);const i={sidebar_label:"12. Kubernetes_k8s"},c="Kubernetes\uff08k8s\uff09",d={id:"bjpowernode/\u5fae\u670d\u52a1\u7ed3\u6784/Kubernetes_k8s",title:"Kubernetes\uff08k8s\uff09",description:"1 \u6982\u8ff0",source:"@site/docs/bjpowernode/06-\u5fae\u670d\u52a1\u7ed3\u6784/12-Kubernetes_k8s.md",sourceDirName:"bjpowernode/06-\u5fae\u670d\u52a1\u7ed3\u6784",slug:"/bjpowernode/\u5fae\u670d\u52a1\u7ed3\u6784/Kubernetes_k8s",permalink:"/ZHENGnotes/bjpowernode/\u5fae\u670d\u52a1\u7ed3\u6784/Kubernetes_k8s",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_label:"12. Kubernetes_k8s"},sidebar:"defaultSidebar",previous:{title:"11. Docker",permalink:"/ZHENGnotes/bjpowernode/\u5fae\u670d\u52a1\u7ed3\u6784/Docker"},next:{title:"15. \u9ad8\u5e76\u53d1\u89e3\u51b3\u65b9\u6848",permalink:"/ZHENGnotes/bjpowernode/\u5fae\u670d\u52a1\u7ed3\u6784/\u9ad8\u5e76\u53d1\u89e3\u51b3\u65b9\u6848\uff08\u9009\u5b66\uff09"}},o={},t=[{value:"1 \u6982\u8ff0",id:"1-\u6982\u8ff0",level:2},{value:"2 \u90e8\u7f72",id:"2-\u90e8\u7f72",level:2},{value:"2.1 Kubeadm\u90e8\u7f72\u96c6\u7fa4",id:"21-kubeadm\u90e8\u7f72\u96c6\u7fa4",level:3},{value:"2.2 \u90e8\u7f72\u5bb9\u5668\u5316\u5e94\u7528",id:"22-\u90e8\u7f72\u5bb9\u5668\u5316\u5e94\u7528",level:3},{value:"3 Ingress\u66b4\u9732\u5e94\u7528",id:"3-ingress\u66b4\u9732\u5e94\u7528",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",mermaid:"mermaid",ol:"ol",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"kubernetesk8s",children:"Kubernetes\uff08k8s\uff09"}),"\n",(0,l.jsx)(n.h2,{id:"1-\u6982\u8ff0",children:"1 \u6982\u8ff0"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)("font",{color:"red",children:"Kubernetes\uff08k8s\uff09"})}),"\uff1a\u5bb9\u5668\u7f16\u6392\u5f15\u64ce\uff0c\u7528\u4e8e\u81ea\u52a8\u5316\u3001\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u3001\u89c4\u5212\u3001\u6269\u5c55\u548c\u7ba1\u7406"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67b6\u6784\u56fe\uff1a",(0,l.jsx)(n.img,{alt:"Kubernetes Cluster Architecture",src:s(4919).A+"",width:"1402",height:"882"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Master"}),"\uff1a\u96c6\u7fa4\u63a7\u5236\u8282\u70b9","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7ec4\u4ef6\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kube-api-server"}),"\uff1a\u96c6\u7fa4\u63a5\u6536\u8bf7\u6c42\u7684\u7edf\u4e00\u5165\u53e3\uff0c\u7ba1\u7406\u6240\u6709\u5bf9\u8c61\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\u548c\u76d1\u542c\u64cd\u4f5c\uff0c\u5c06\u4fe1\u606f\u5b58\u50a8\u5230etcd\u6570\u636e\u5e93\u4e2d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"etcd"}),"\uff1a\u5206\u5e03\u5f0f\u952e\u503c\u5b58\u50a8\u7cfb\u7edf\uff0c\u7528\u6765\u4fdd\u5b58\u96c6\u7fa4\u72b6\u6001\u7684\u6570\u636e\uff1b\u6709\u81ea\u52a8\u53d1\u73b0\u670d\u52a1\u7684\u673a\u5236\uff0c\u4f1a\u6309\u7167\u8282\u70b9\u6570\u642d\u5efa"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"scheduler"}),"\uff1a\u8c03\u5ea6\u8d44\u6e90\uff0c\u4f1a\u6839\u636e\u8c03\u5ea6\u7b97\u6cd5\u4e3a\u65b0\u521b\u5efa\u7684pod\u9009\u62e9node\u8282\u70b9"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"controller-manager"}),"\uff1a\u5904\u7406\u96c6\u7fa4\u4e2d\u5e38\u89c4\u7684\u540e\u53f0\u4efb\u52a1\uff0c\u7ba1\u7406\u8d44\u6e90\u7684\u63a7\u5236\u5668"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u4f5c\u7528\uff1a\u5bf9\u96c6\u7fa4\u8fdb\u884c\u8c03\u5ea6\u7ba1\u7406\uff0c\u63a5\u53d7\u96c6\u7fa4\u5916\u7528\u6237\u53bb\u96c6\u7fa4\u64cd\u4f5c\u8bf7\u6c42"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Node"}),"\uff1a\u96c6\u7fa4\u5de5\u4f5c\u8282\u70b9 ",(0,l.jsx)(n.code,{children:"Worker Nodes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7ec4\u4ef6\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kubelet"}),"\uff1a",(0,l.jsx)(n.code,{children:"Master"})," \u5728 ",(0,l.jsx)(n.code,{children:"Node"})," \u4e0a\u7684\u4ee3\u7406\uff0c\u7ba1\u7406\u5f53\u524d ",(0,l.jsx)(n.code,{children:"Node"})," \u7684\u8fd0\u884c\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\uff1b\u4f1a\u628a\u6bcf\u4e2apod\u8f6c\u6362\u6210\u4e00\u7ec4\u5bb9\u5668"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kube-proxy"}),"\uff1a\u7528\u6765\u5b9e\u73b0pod\u7684\u7f51\u7edc\u4ee3\u7406\uff0c\u7ef4\u62a4\u7f51\u7edc\u89c4\u5219\u548c\u8d1f\u8f7d\u5747\u8861"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pod"}),"\uff08Container Runtime\uff09\uff1a\u4e00\u822c\u4e00\u4e2apod\u4e2d ",(0,l.jsx)(n.strong,{children:"\u53ea\u5305\u542b\u4e00\u4e2a"})," \u5bb9\u5668\uff08\u4e00\u822c\u662fdocker\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u4f5c\u7528\uff1a\u8fd0\u884c\u7528\u6237\u4e1a\u52a1\u5e94\u7528\u5bb9\u5668"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.admonition,{title:"\u6838\u5fc3\u6982\u5ff5",type:"danger",children:[(0,l.jsx)(n.mermaid,{value:"graph TD\nsubgraph service\n    subgraph controller[controller\uff08deployment\uff09]\n        subgraph pod\n            subgraph container[container\uff08docker\uff09]\n            end\n        end\n    end\nend"}),(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"service"}),"\uff1a\u9632\u6b62pod\u5931\u8054\uff0c\u5b9a\u4e49pod\u7ec4\u7684\u8bbf\u95ee\u7b56\u7565"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"controller"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"deployment"}),"\uff1a",(0,l.jsx)(n.strong,{children:"\u65e0\u72b6\u6001"})," \u5e94\u7528\u90e8\u7f72\uff08\u5982nginx\u3001apache\uff09\uff0c\u4e0d\u4f1a\u5f71\u54cd\u7528\u6237\u4f7f\u7528"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"statefulset"}),"\uff1a",(0,l.jsx)(n.strong,{children:"\u6709\u72b6\u6001"})," \u5e94\u7528\u90e8\u7f72\uff0c\u4f1a\u5f71\u54cd\u7528\u6237\u4f7f\u7528"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"replicaset"}),"\uff1apod\u526f\u672c\u6570"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"daemonset"}),"\uff1a\u76d1\u7763node\u8fd0\u884c\u7684\u662f\u540c\u4e00\u4e2apod\uff0c\u4e14pod\u5728\u7edf\u4e00\u7684\u547d\u540d\u7a7a\u95f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"job"}),"\uff1a\u4e00\u6b21\u6027\u4efb\u52a1"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"cronjob"}),"\uff1a\u5b9a\u65f6\u4efb\u52a1"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pod"}),"\uff1a\u6700\u5c0f\u90e8\u7f72\u5355\u5143\uff0c\u662f\u4e00\u7ec4\u5bb9\u5668\u7684\u96c6\u5408\uff08\u5171\u4eab\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5176\u5b83\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"storage"}),"\uff1a\u6570\u636e\u5b58\u50a8\uff0c\u5982",(0,l.jsx)(n.code,{children:"volumes"}),"\u3001",(0,l.jsx)(n.code,{children:"persistent volumes"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pollcies"})," \u7b56\u7565\uff1a",(0,l.jsx)(n.code,{children:"resource quotas"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"label"}),"\uff1a\u6807\u7b7e\uff0c\u7528\u4e8e\u5173\u8054\u5bf9\u8c61\u3001\u67e5\u8be2\u548c\u7b5b\u9009"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"namespaces"}),"\uff1a\u547d\u540d\u7a7a\u95f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"annotations"}),"\uff1a\u6ce8\u91ca"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["\u642d\u5efak8s\u96c6\u7fa4\u7684\u65b9\u5f0f\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/tutorials/hello-minikube/",children:"minikube"}),"\uff1a\u5728\u672c\u5730\u8fd0\u884c\u4e00\u4e2a\u5355\u8282\u70b9\u7684k8s\u96c6\u7fa4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://kind.sigs.k8s.io/",children:"kind"}),"\uff1a\u5728\u672c\u5730\u8fd0\u884ck8s\u96c6\u7fa4\uff0c\u4f46\u9700\u8981\u5b89\u88c5\u548c\u914d\u7f6eDocker"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/",children:"kubeadm"}),"\uff1ak8s\u96c6\u7fa4\u90e8\u7f72\u5de5\u5177"]}),"\n",(0,l.jsx)(n.li,{children:"\u4e0b\u8f7d\u53d1\u884c\u7248\u7684\u4e8c\u8fdb\u5236\u5305\uff0c\u624b\u52a8\u90e8\u7f72\u5b89\u88c5\u6bcf\u4e2a\u7ec4\u4ef6\u4ee5\u7ec4\u6210k8s\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7yum\u5b89\u88c5\u6bcf\u4e2a\u7ec4\u4ef6\u4ee5\u7ec4\u6210k8s\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.li,{children:"\u7b2c\u4e09\u65b9\u5de5\u5177"}),"\n",(0,l.jsx)(n.li,{children:"\u82b1\u94b1\u8d2d\u4e70\uff1a\u5982\u963f\u91cc\u4e91\u7684\u516c\u6709\u4e91\u5e73\u53f0\u7b49"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"2-\u90e8\u7f72",children:"2 \u90e8\u7f72"}),"\n",(0,l.jsx)(n.h3,{id:"21-kubeadm\u90e8\u7f72\u96c6\u7fa4",children:"2.1 Kubeadm\u90e8\u7f72\u96c6\u7fa4"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u51c6\u5907\u73af\u5883\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5173\u95ed\u9632\u706b\u5899\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"systemctl stop firewalld\nsystemctl disable firewalld\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5173\u95edselinux\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"# \u6c38\u4e45\nsed -i 's/enforcing/disabled/' /etc/selinux/config\n# \u4e34\u65f6\nsetenforce 0\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5173\u95edswap\uff1a\u2192 k8s\u7981\u6b62\u865a\u62df\u5185\u5b58\u4ee5\u63d0\u9ad8\u6027\u80fd","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"# \u6c38\u4e45\nsed -ri 's/.*swap.*/#&/' /etc/fstab\n# \u4e34\u65f6\nswapoff -a\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8bbe\u7f6e\u7f51\u6865\u53c2\u6570\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"cat > /etc/sysctl.d/k8s.conf << EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsysctl --system\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u65f6\u95f4\u540c\u6b65\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"yum install ntpdate -y\nntpdate time.windows.com\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5b89\u88c5\u76f8\u5173\u7ec4\u4ef6\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7ec4\u4ef6\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"kubelet\uff1a\u8fd0\u884c\u5728\u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u4e0a\uff0c\u8d1f\u8d23\u542f\u52a8pod\u548c\u5bb9\u5668"}),"\n",(0,l.jsx)(n.li,{children:"kubeadm\uff1a\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u5de5\u5177"}),"\n",(0,l.jsx)(n.li,{children:"kubectl\uff1a\u547d\u4ee4\u884c\u5de5\u5177"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5b89\u88c5\u547d\u4ee4\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Docker\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5b89\u88c5 ",(0,l.jsx)(n.code,{children:"19.03.13"})," \u7248\u672c\u7684docker\uff1a",(0,l.jsx)(n.code,{children:"yum install docker-ce-19.03.13 -y"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u542f\u52a8docker\uff1a",(0,l.jsx)(n.code,{children:"systemctl enable docker.service"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["kubeadm\u3001kubelet\u3001kubectl\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6dfb\u52a0k8s\u7684\u963f\u91cc\u4e91YUM\u6e90\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"cat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl\uff1a",(0,l.jsx)(n.code,{children:"yum install kubelet-1.19.4 kubeadm-1.19.4 kubectl-1.19.4 -y"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u542f\u52a8kubelet\uff1a",(0,l.jsx)(n.code,{children:"systemctl enable kubelet.service"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7f51\u7edc\u63d2\u4ef6\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e0b\u8f7d ",(0,l.jsx)(n.code,{children:"kube-flannel.yml"})," \u6587\u4ef6\uff1a",(0,l.jsx)(n.code,{children:"wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u642d\u5efa\u96c6\u7fa4\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Master"})," \u8282\u70b9\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u521b\u5efa\u8282\u70b9\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubeadm init \\\n--apiserver-advertise-address=<master-ip> \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.19.4 \\\n--service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6267\u884c\u5b98\u65b9\u5efa\u8bae\u547d\u4ee4\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\uff1a",(0,l.jsx)(n.code,{children:"kubectl get nodes"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u5e94\u7528 ",(0,l.jsx)(n.code,{children:"kube-flannel.yml"})," \u6587\u4ef6\u5f97\u5230\u8fd0\u884c\u65f6\u5bb9\u5668\uff1a",(0,l.jsx)(n.code,{children:"kubectl apply -f kube-flannel.yml"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5c06 ",(0,l.jsx)(n.code,{children:"Worker Node"})," \u8282\u70b9\u52a0\u5165\u5230\u96c6\u7fa4\u4e2d\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubeadm join <master-ip>:<master-port> \\\n--token <token> \\\n--discovery-token-ca-cert-hash <hash>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"22-\u90e8\u7f72\u5bb9\u5668\u5316\u5e94\u7528",children:"2.2 \u90e8\u7f72\u5bb9\u5668\u5316\u5e94\u7528"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5bb9\u5668\u5316\u5e94\u7528\uff1a\u653e\u5728docker\u91cc\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f"}),"\n",(0,l.jsxs)(n.li,{children:["\u90e8\u7f72\u6b65\u9aa4\uff1a","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u83b7\u53d6\u955c\u50cf\uff1a",(0,l.jsx)(n.code,{children:"Dockerfile"})," \u6587\u4ef6\u5236\u4f5c\u955c\u50cf\uff0c\u6216\u4ece\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf"]}),"\n",(0,l.jsxs)(n.li,{children:["\u542f\u52a8\u955c\u50cf \u2192 \u5f97\u5230\u5728pod\u91cc\u7684\u5bb9\u5668\uff0c\u5e76\u901a\u8fc7\u63a7\u5236\u5668\u7ba1\u7406pod","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u521b\u5efa ",(0,l.jsx)(n.code,{children:"deployment"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kubectl create deployment <deployment-name> --image=<image-name>"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kubectl apply -f <yaml-file>"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kubectl create deployment <deployment-name> --image=<image-name> --dry-run -o yaml > <yaml-file>"}),"\uff1a\u53ef\u901a\u8fc7\u8be5\u547d\u4ee4\u83b7\u53d6\u5df2\u6709 ",(0,l.jsx)(n.code,{children:"deployment"})," \u7684 ",(0,l.jsx)(n.code,{children:".yaml"})," \u6587\u4ef6"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\u4fe1\u606f\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubectl get node(s)\nkubectl get service(s)\nkubectl get deployment (deploy)\nkubectl get pod(s)\nkubectl describe pods <pod-name>\nkubectl logs <service/deployment/pod-name>\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5220\u9664 ",(0,l.jsx)(n.code,{children:"deployment"})," \u53ca\u5176\u76f8\u5173\u670d\u52a1\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubectl delete service <service-name>\nkubectl delete deployment <deployment-name>\nkubectl delete pod <pod-name>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u66b4\u9732\u670d\u52a1 \u2192 \u5916\u754c\u53ef\u4ee5\u8bbf\u95ee","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kubectl expose deployment <deployment-name> --port=<port> --type=NodePort"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/kubernetes/dashboard",children:"Kubernetes Dashbaord"}),"\uff1a\u7ba1\u7406k8s\u96c6\u7fa4\uff08\u5305\u542b\u96c6\u7fa4\u672c\u8eab\u4ee5\u53ca\u5176\u4e2d\u8fd0\u884c\u7740\u7684\u5e94\u7528\u7a0b\u5e8f\uff09\u7684\u4eea\u8868\u76d8","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e0b\u8f7d\u3001\u521b\u5efa ",(0,l.jsx)(n.code,{children:"deployment"})," \u5e76\u66b4\u9732\u670d\u52a1\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.4/aio/deploy/recommended.yaml\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8bbf\u95ee\u4eea\u8868\u76d8\u65f6\u9700\u8981\u8f93\u5165token\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubectl create serviceaccount dashboard-admin -n kube-system\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin\nkubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk '/dashboard-admin/{print $1}')\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"3-ingress\u66b4\u9732\u5e94\u7528",children:"3 Ingress\u66b4\u9732\u5e94\u7528"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["NodePort\uff1a\u8ba9\u5916\u90e8\u8bf7\u6c42\u76f4\u63a5\u8bbf\u95ee\u670d\u52a1\u7684\u6700\u539f\u59cb\u65b9\u5f0f\uff0c\u4f46\u4e00\u4e2a\u7aef\u53e3\u53ea\u80fd\u4f9b\u4e00\u4e2a\u670d\u52a1\u4f7f\u7528\uff0c\u4e14\u53d1\u751f\u53d8\u5316\u7684IP\u9700\u8981\u4eba\u5de5\u5904\u7406 \u2192 \u4e0d\u63a8\u8350\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"NodePort\u5728\u6240\u6709\u7684\u8282\u70b9\u4e0a\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3\uff0c\u53d1\u9001\u5230\u8fd9\u4e2a\u7aef\u53e3\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u76f4\u63a5\u8f6c\u53d1\u5230\u670d\u52a1\u4e2d\u7684pod\u91cc"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"nodePort"}),"\uff1a\u672a\u6307\u5b9a\u7aef\u53e3\u65f6\uff0c\u4f1a\u968f\u673a\u9009\u62e930000\u201332767\u4e4b\u95f4\u7684\u7aef\u53e3"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.admonition,{title:"\u670d\u52a1\u7aef\u53e3\u8bf4\u660e",type:"note",children:[(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yml",metastring:"showLineNumbers",children:"ports:  \n  - port: 80\n    targetPort: 80\n    nodePort: 30008\n    protocol: TCP\n"})}),(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"port"}),"\uff1ak8s\u96c6\u7fa4\u4e2d\u7684\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u8bbf\u95ee\u7684\u7aef\u53e3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"targetPort"}),"\uff1a\u5bb9\u5668\u7684\u7aef\u53e3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"nodePort"}),"\uff1a\u8282\u70b9\u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3"]}),"\n"]})]}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:["LoadBalancer\uff1a\u5916\u90e8\u8bf7\u6c42\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5668 ",(0,l.jsx)(n.code,{children:"LoadBlancer"})," \u8f6c\u53d1\u5230\u670d\u52a1\u4e2d\u7684Pod\u91cc\uff0c\u4f46\u9700\u8981\u5411\u4e91\u5e73\u53f0\u7533\u8bf7\u8d1f\u8f7d\u5747\u8861\u5668 \u2192 \u4e0d\u63a8\u8350\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.a,{href:"https://github.com/kubernetes/ingress-nginx",children:"Ingress"})}),"\uff1a\u5916\u90e8\u8bf7\u6c42\u8bbf\u95eek8s\u96c6\u7fa4\u7684\u5fc5\u7ecf\u4e4b\u53e3\uff0c\u76f8\u5f53\u4e8e\u96c6\u7fa4\u7f51\u5173\u53ef\u81ea\u5b9a\u4e49\u8def\u7531\u89c4\u5219\u6765\u8f6c\u53d1\u3001\u7ba1\u7406\u3001\u66b4\u9732\u670d\u52a1\uff08\u4e00\u7ec4pod\uff09","\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u90e8\u7f72Ingress Nginx\uff1a\u7528Nginx\u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\u5668\u7684Ingress","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e0b\u8f7d\u3001\u521b\u5efa ",(0,l.jsx)(n.code,{children:"deployment"})," \u5e76\u66b4\u9732\u670d\u52a1\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/baremetal/deploy.yaml\n"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u955c\u50cf\u5730\u5740\u4fee\u6539\u4e3a\u56fd\u5185\u5730\u5740"}),"\n",(0,l.jsxs)(n.li,{children:["\u4fee\u6539\u955c\u50cf\u5730\u5740\u7684\u7236\u7ea7\u4e0a\u6dfb\u52a0\u914d\u7f6e\u9879 ",(0,l.jsx)(n.code,{children:"spec.hostNetwork: true"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770bIngress\u7684\u72b6\u6001\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kubectl get service -n ingress-nginx"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kubectl get deploy -n ingress-nginx"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kubectl get pods -n ingress-nginx"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u914d\u7f6eIngress Nginx\u89c4\u5219\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5e94\u7528\uff1a",(0,l.jsx)(n.code,{children:"kubectl apply -f ingress-nginx-rule.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\uff1a",(0,l.jsx)(n.code,{children:"kubectl get ing(ress)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},4919:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/12.1.kubernetes_cluster_architecture-f994f6213fc298e112bffe059809e886.svg"},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var l=s(6540);const r={},i=l.createContext(r);function c(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);