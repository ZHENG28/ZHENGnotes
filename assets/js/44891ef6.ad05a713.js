"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[3320],{7013:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>x,frontMatter:()=>o,metadata:()=>l,toc:()=>t});var i=s(4848),r=s(8453);const o={sidebar_label:"6. SpringSession"},d="SpringSession",l={id:"bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/SpringSession",title:"SpringSession",description:"1. \u4f1a\u8bdd",source:"@site/docs/bjpowernode/07-\u4e92\u8054\u7f51\u751f\u6001/06-SpringSession.md",sourceDirName:"bjpowernode/07-\u4e92\u8054\u7f51\u751f\u6001",slug:"/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/SpringSession",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/SpringSession",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_label:"6. SpringSession"},sidebar:"defaultSidebar",previous:{title:"1. Linux",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/Linux"},next:{title:"7. MySQL\u96c6\u7fa4",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/MySQL\u96c6\u7fa4"}},c={},t=[{value:"1. \u4f1a\u8bdd",id:"1-\u4f1a\u8bdd",level:2},{value:"1.1. \u6982\u8ff0",id:"11-\u6982\u8ff0",level:3},{value:"1.2. \u96c6\u7fa4\u6a21\u5f0f\u5b58\u5728\u7684\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848",id:"12-\u96c6\u7fa4\u6a21\u5f0f\u5b58\u5728\u7684\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848",level:3},{value:"2. \u5e94\u7528",id:"2-\u5e94\u7528",level:2},{value:"2.1. \u540c\u57df\u540d\u4e0b\u76f8\u540c\u9879\u76ee\uff08\u5373\u96c6\u7fa4\u73af\u5883\uff09",id:"21-\u540c\u57df\u540d\u4e0b\u76f8\u540c\u9879\u76ee\u5373\u96c6\u7fa4\u73af\u5883",level:3},{value:"2.2. \u540c\u57df\u540d\u4e0b\u4e0d\u540c\u9879\u76ee",id:"22-\u540c\u57df\u540d\u4e0b\u4e0d\u540c\u9879\u76ee",level:3},{value:"2.3. \u540c\u6839\u57df\u540d\u4e0d\u540c\u4e8c\u7ea7\u5b50\u57df\u540d\u4e0b\u7684\u9879\u76ee",id:"23-\u540c\u6839\u57df\u540d\u4e0d\u540c\u4e8c\u7ea7\u5b50\u57df\u540d\u4e0b\u7684\u9879\u76ee",level:3},{value:"2.4. \u4e0d\u540c\u6839\u57df\u540d\u4e0b\u7684\u9879\u76ee\uff08\u5373\u5355\u70b9\u767b\u5f55\uff09",id:"24-\u4e0d\u540c\u6839\u57df\u540d\u4e0b\u7684\u9879\u76ee\u5373\u5355\u70b9\u767b\u5f55",level:3},{value:"2.5. \u96c6\u6210SpringBoot",id:"25-\u96c6\u6210springboot",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"springsession",children:"SpringSession"}),"\n",(0,i.jsx)(n.h2,{id:"1-\u4f1a\u8bdd",children:"1. \u4f1a\u8bdd"}),"\n",(0,i.jsx)(n.h3,{id:"11-\u6982\u8ff0",children:"1.1. \u6982\u8ff0"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4f1a\u8bdd ",(0,i.jsx)(n.code,{children:"Session"}),"\uff1a\u8bb0\u5f55\u7528\u6237\u72b6\u6001\uff0c\u4ece\u800c\u4f7f\u670d\u52a1\u7aef\u80fd\u8bc6\u522b\u7528\u6237"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cookie"}),"\uff1a\u7528\u6765\u5b58\u50a8\u76f8\u5173\u5ba2\u6237\u7aef\u4fe1\u606f\uff08\u5982 ",(0,i.jsx)(n.code,{children:"sessionId"}),"\uff09\uff0cHTTP\u8bf7\u6c42\u65f6\u4f1a\u53d1\u9001\u5bf9\u5e94\u7684 ",(0,i.jsx)(n.code,{children:"Cookie"})," \u4fe1\u606f\u5230\u670d\u52a1\u7aef"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef\u7981\u7528 ",(0,i.jsx)(n.code,{children:"Cookie"})," \u65f6\uff0c\u53ef\u4ee5\u91c7\u7528",(0,i.jsx)(n.strong,{children:"URL\u91cd\u5199"}),"\u6765\u8fdb\u884c\u4f1a\u8bdd\u8ffd\u8e2a\uff0c\u5373\u5728URL\u540e\u9644\u4e0a ",(0,i.jsx)(n.code,{children:"sessionId=xxx"})," \u53c2\u6570"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Session"})," \u5b58\u653e\u673a\u5236\uff1a","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u9996\u6b21\u8bf7\u6c42\uff1a","\n",(0,i.jsx)(n.mermaid,{value:"graph LR\nsubgraph browser\n    direction TB\n    \u6d4f\u89c8\u5668 --- Cookie\u5bb9\u5668 --- cookie_content[\u7a7a]\nend\nsubgraph jvm\n    direction TB\n    JVM --- Session\u5bb9\u5668 --- session_content[\u7a7a]\nend\nbrowser --\u8bf7\u6c42\u643a\u5e26Cookie\u6570\u636e--\x3e server[Tomcat\u670d\u52a1\u5668] --\u67e5\u8be2\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684sessionId\\n\u82e5\u6ca1\u6709\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684session\u548csessionId--- jvm\nserver --\u8fd4\u56de\u65b0sessionId\uff08123\uff09\u5e76\u5b58\u5165--\x3e browser"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6b63\u5e38\u8bf7\u6c42\uff08session\u6709\u6548\uff09\uff1a","\n",(0,i.jsx)(n.mermaid,{value:"graph RL\nsubgraph browser\n    direction TB\n    \u6d4f\u89c8\u5668 --- Cookie\u5bb9\u5668 --- 'sessionId'-123\nend\nsubgraph jvm\n    direction TB\n    JVM --- Session\u5bb9\u5668 --- 123-sessionId\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\nend\nbrowser --sessionId=123--\x3e server[Tomcat\u670d\u52a1\u5668] --\u67e5\u627e\u5bf9\u5e94\u7684sessionId--\x3e jvm --\u8fd4\u56deSession\u4e2d\u7684\u4fe1\u606f--\x3e server\nserver --\u54cd\u5e94--\x3e browser"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6b63\u5e38\u8bf7\u6c42\uff08session\u5931\u6548\uff09\uff1a\u670d\u52a1\u5668\u91cd\u65b0\u751f\u6210sessionId\u540e\uff0c",(0,i.jsx)(n.code,{children:"Session\u5bb9\u5668"})," \u548c ",(0,i.jsx)(n.code,{children:"Cookie\u5bb9\u5668"})," \u4e2d\u90fd\u9700\u8981\u66f4\u65b0","\n",(0,i.jsx)(n.mermaid,{value:"graph RL\nsubgraph browser\n    direction TB\n    \u6d4f\u89c8\u5668 --- Cookie\u5bb9\u5668 --- 'sessionId'-123\nend\nsubgraph jvm\n    direction TB\n    JVM --- Session\u5bb9\u5668 --- 123-sessionId\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\nend\nbrowser --sessionId=123--\x3e server[Tomcat\u670d\u52a1\u5668] --\u67e5\u627e\u5bf9\u5e94\u7684sessionId--\x3e jvm --session\u5931\u6548--\x3e server\nserver --\u91cd\u65b0\u751f\u6210\u65b0sessionId\uff08234\uff09--\x3e browser"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"12-\u96c6\u7fa4\u6a21\u5f0f\u5b58\u5728\u7684\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848",children:"1.2. \u96c6\u7fa4\u6a21\u5f0f\u5b58\u5728\u7684\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u95ee\u9898\uff1a\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0ctomcat\u670d\u52a1\u5668\u4e4b\u95f4\u65e0\u6cd5\u5171\u4eabsession"}),"\n",(0,i.jsxs)(n.li,{children:["\u89e3\u51b3\u65b9\u6848\uff1a","\n",(0,i.jsx)(n.mermaid,{value:"graph LR\nsubgraph browser\n    direction TB\n    \u6d4f\u89c8\u5668 --- Cookie\u5bb9\u5668 --- 'sessionId'-123\nend\nsubgraph \u5171\u4eab\u5bb9\u5668\n    direction TB\n    Session\u5bb9\u5668 --- 123-sessionId\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\nend\nbrowser --\u8bf7\u6c42--\x3e nginx[Nginx] --\u8d1f\u8f7d\u5747\u8861--\x3e server1[Tomcat\u670d\u52a1\u56681] --\u67e5\u627e\u5bf9\u5e94\u7684sessionId--- \u5171\u4eab\u5bb9\u5668\nnginx[Nginx] --\u8d1f\u8f7d\u5747\u8861--\x3e server2[Tomcat\u670d\u52a1\u56682] --\u67e5\u627e\u5bf9\u5e94\u7684sessionId--- \u5171\u4eab\u5bb9\u5668"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5bb9\u5668\u6269\u5c55\u63d2\u4ef6\uff1a\u590d\u5236session\u5230\u5176\u4ed6\u670d\u52a1\u5668\uff0c\u4f46\u5b58\u5728\u5ef6\u8fdf\uff0c\u5982 ",(0,i.jsx)(n.code,{children:"tomcat-redis-session-manager"}),"\u3001",(0,i.jsx)(n.code,{children:"memcached-session-manager"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u65e0\u9700\u6539\u52a8\u4ee3\u7801\uff0c\u4f46\u8fc7\u4e8e\u4f9d\u8d56tomcat\u5bb9\u5668"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["nginx\u7684 ",(0,i.jsx)(n.code,{children:"ip_hash"})," \u7b56\u7565\uff1a\u7528\u6237\u6bcf\u6b21\u8bbf\u95ee\u90fd\u7ed1\u5b9a\u5230\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ip\u4e0d\u80fd\u53d8 \u2192 \u5931\u6548"}),"\n",(0,i.jsx)(n.li,{children:"\u670d\u52a1\u5668\u53d1\u751f\u6545\u969c \u2192 \u5931\u6548"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u81ea\u884c\u5f00\u53d1session\u7ba1\u7406\u7684\u5de5\u5177\u7c7b\uff1a\u9700\u8981\u6539\u52a8\u4ee3\u7801"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Spring Session"}),"\uff1a\u65e2\u4e0d\u4f9d\u8d56tomcat\u5bb9\u5668\uff0c\u53c8\u65e0\u9700\u6539\u52a8\u4ee3\u7801"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-\u5e94\u7528",children:"2. \u5e94\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"21-\u540c\u57df\u540d\u4e0b\u76f8\u540c\u9879\u76ee\u5373\u96c6\u7fa4\u73af\u5883",children:"2.1. \u540c\u57df\u540d\u4e0b\u76f8\u540c\u9879\u76ee\uff08\u5373\u96c6\u7fa4\u73af\u5883\uff09"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Spring Session"}),"\uff1a\u4f1a\u5c06servlet\u5bb9\u5668\u4e2d\u5b9e\u73b0\u7684 ",(0,i.jsx)(n.code,{children:"javax.servlet.http.HttpSession"})," \u66ff\u6362\u6210 ",(0,i.jsx)(n.code,{children:"spring-session"}),"\uff0c\u5c06session\u4fe1\u606f\u5b58\u50a8\u5728redis\u4e2d"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0\u6b65\u9aa4\uff1a","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6dfb\u52a0\u4f9d\u8d56\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",metastring:"showLineNumbers",children:"<dependency>\n    <groupId>org.springframework.session</groupId>\n    <artifactId>spring-session-data-redis</artifactId>\n</dependency>\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6dfb\u52a0\u8fc7\u6ee4\u5668 ",(0,i.jsx)(n.code,{children:"org.springframework.web.filter.DelegatingFilterProxy"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u6dfb\u52a0bean\u5bf9\u8c61 ",(0,i.jsx)(n.code,{children:"org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"22-\u540c\u57df\u540d\u4e0b\u4e0d\u540c\u9879\u76ee",children:"2.2. \u540c\u57df\u540d\u4e0b\u4e0d\u540c\u9879\u76ee"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cookie"})," \u4e0d\u5141\u8bb8\u8de8\u8def\u5f84\u8bbf\u95ee \u2192 session\u5931\u6548"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0\u6b65\u9aa4\uff1a","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RedisHttpSessionConfiguration"})," \u5bf9\u8c61\u4e2d\u6dfb\u52a0 ",(0,i.jsx)(n.code,{children:"Cookie"})," \u5e8f\u5217\u5316\u89c4\u5219\u63a5\u53e3\u5bf9\u8c61"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"Cookie"})," \u5e8f\u5217\u5316\u89c4\u5219\u5bf9\u8c61 ",(0,i.jsx)(n.code,{children:"org.springframework.session.web.http.DefaultCookieSerializer"}),"\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cookiePath"})," \u6307\u5b9a ",(0,i.jsx)(n.code,{children:"sessionId"})," \u5b58\u653e\u5728",(0,i.jsx)(n.strong,{children:"\u540c\u4e00\u6839\u8def\u5f84"}),"\u4e0b"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"23-\u540c\u6839\u57df\u540d\u4e0d\u540c\u4e8c\u7ea7\u5b50\u57df\u540d\u4e0b\u7684\u9879\u76ee",children:"2.3. \u540c\u6839\u57df\u540d\u4e0d\u540c\u4e8c\u7ea7\u5b50\u57df\u540d\u4e0b\u7684\u9879\u76ee"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cookie"})," \u4e0d\u5141\u8bb8\u8de8\u57df\u540d\u8bbf\u95ee \u2192 session\u5931\u6548"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0\u6b65\u9aa4\uff1a","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RedisHttpSessionConfiguration"})," \u5bf9\u8c61\u4e2d\u6dfb\u52a0 ",(0,i.jsx)(n.code,{children:"Cookie"})," \u5e8f\u5217\u5316\u89c4\u5219\u63a5\u53e3\u5bf9\u8c61"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"Cookie"})," \u5e8f\u5217\u5316\u89c4\u5219\u5bf9\u8c61 ",(0,i.jsx)(n.code,{children:"org.springframework.session.web.http.DefaultCookieSerializer"}),"\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"domainName"})," \u6307\u5b9a ",(0,i.jsx)(n.code,{children:"sessionId"})," \u5b58\u653e\u5728",(0,i.jsx)(n.strong,{children:"\u540c\u4e00\u6839\u57df\u540d"}),"\u4e0b"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"24-\u4e0d\u540c\u6839\u57df\u540d\u4e0b\u7684\u9879\u76ee\u5373\u5355\u70b9\u767b\u5f55",children:"2.4. \u4e0d\u540c\u6839\u57df\u540d\u4e0b\u7684\u9879\u76ee\uff08\u5373\u5355\u70b9\u767b\u5f55\uff09"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Spring Session"})," \u4e0d\u652f\u6301"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)("font",{color:"red",children:"\u5355\u70b9\u767b\u5f55SSO\uff08Single Sign On\uff09"})}),"\uff1a\u7528\u6237\u53ea\u9700\u767b\u5f55",(0,i.jsx)(n.strong,{children:"\u4e00\u6b21"}),"\u5373\u53ef\u8bbf\u95ee",(0,i.jsx)(n.strong,{children:"\u6240\u6709"}),"\u76f8\u4e92\u4fe1\u4efb\u7684\u5e94\u7528\u7cfb\u7edf"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"25-\u96c6\u6210springboot",children:"2.5. \u96c6\u6210SpringBoot"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6dfb\u52a0\u4f9d\u8d56\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",metastring:"showLineNumbers",children:"<dependency>\n    <groupId>org.springframework.session</groupId>\n    <artifactId>spring-session-data-redis</artifactId>\n</dependency>\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u914d\u7f6e\u6587\u4ef6\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",metastring:"showLineNumbers",children:"# \u8bbe\u7f6eSession\u7684\u751f\u547d\u5468\u671f\nserver.servlet.session.timeout=30m\n\n# \u6307\u5b9aCookie\u7684\u5b58\u653e\u8def\u5f84\uff0c\u7528\u4e8e\u5b9e\u73b0\u540c\u57df\u540d\u4e0b\u4e0d\u540c\u9879\u76ee\u7684Session\u5171\u4eab\nserver.servlet.session.cookie.path=/\n\n# \u6307\u5b9aCookie\u7684\u5b58\u653e\u57df\u540d\uff0c\u7528\u4e8e\u5b9e\u73b0\u540c\u6839\u57df\u540d\u4e0d\u540c\u4e8c\u7ea7\u5b50\u57df\u540d\u4e0b\u7684\u9879\u76ee\u7684Session\u5171\u4eab\nserver.servlet.session.cookie.domain=example.com\n"})}),"\n"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var i=s(6540);const r={},o=i.createContext(r);function d(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);