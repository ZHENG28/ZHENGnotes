"use strict";(globalThis.webpackChunknotebook=globalThis.webpackChunknotebook||[]).push([[2301],{6057(e,n,a){a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var s=a(4848),r=a(8453);const i={sidebar_label:"7. MySQL\u96c6\u7fa4"},t="MySQL\u96c6\u7fa4",o={id:"bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/MySQL\u96c6\u7fa4",title:"MySQL\u96c6\u7fa4",description:"1. \u4e3b\u4ece\u590d\u5236",source:"@site/docs/bjpowernode/07-\u4e92\u8054\u7f51\u751f\u6001/07-MySQL\u96c6\u7fa4.md",sourceDirName:"bjpowernode/07-\u4e92\u8054\u7f51\u751f\u6001",slug:"/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/MySQL\u96c6\u7fa4",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/MySQL\u96c6\u7fa4",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_label:"7. MySQL\u96c6\u7fa4"},sidebar:"defaultSidebar",previous:{title:"6. SpringSession",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/SpringSession"},next:{title:"8. Nginx",permalink:"/ZHENGnotes/bjpowernode/\u4e92\u8054\u7f51\u751f\u6001/Nginx"}},c={},l=[{value:"1. \u4e3b\u4ece\u590d\u5236",id:"1-\u4e3b\u4ece\u590d\u5236",level:2},{value:"1.1. \u6982\u8ff0",id:"11-\u6982\u8ff0",level:3},{value:"1.2. MySQL\u591a\u5b9e\u4f8b",id:"12-mysql\u591a\u5b9e\u4f8b",level:3},{value:"2. \u591a\u6570\u636e\u6e90",id:"2-\u591a\u6570\u636e\u6e90",level:2},{value:"2.1. JDBC",id:"21-jdbc",level:3},{value:"2.2. Hibernate\uff08SSH\uff09",id:"22-hibernatessh",level:3},{value:"2.3. Mybatis\uff08SSM\uff09",id:"23-mybatisssm",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",mermaid:"mermaid",ol:"ol",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"mysql\u96c6\u7fa4",children:"MySQL\u96c6\u7fa4"}),"\n",(0,s.jsx)(n.h2,{id:"1-\u4e3b\u4ece\u590d\u5236",children:"1. \u4e3b\u4ece\u590d\u5236"}),"\n",(0,s.jsx)(n.h3,{id:"11-\u6982\u8ff0",children:"1.1. \u6982\u8ff0"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u4e3b\u4ece\u590d\u5236\uff08master-slave\uff09"}),"\uff1a\u670d\u52a1\u5668\u5206\u4e3a\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\uff0c\u4e3b\u670d\u52a1\u5668\u8d1f\u8d23 ",(0,s.jsx)(n.strong,{children:"\u8bfb"})," \u548c ",(0,s.jsx)(n.strong,{children:"\u5199"}),"\uff0c\u4ece\u670d\u52a1\u5668\u53ea\u8d1f\u8d23 ",(0,s.jsx)(n.strong,{children:"\u8bfb"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u6570\u636e\u5e93\u7684\u5907\u4efd\u548c\u8bfb\u5199\u5206\u79bb"}),"\n",(0,s.jsx)(n.li,{children:"\u907f\u514d\u670d\u52a1\u7684\u4e0d\u53ef\u7528\uff0c\u4fdd\u969c\u6570\u636e\u7684\u5b89\u5168\u53ef\u9760\u6027"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u67b6\u6784\uff1a","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e00\u4e3b\u591a\u4ece\uff1a",(0,s.jsx)(n.img,{alt:"1 Master and n Slave",src:a(4978).A+"",width:"1037",height:"395"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u53cc\u4e3b\u53cc\u4ece\uff1a",(0,s.jsx)(n.img,{alt:"2 Master and 2 Slave",src:a(9730).A+"",width:"951",height:"422"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4ece\u673a\u4f9d\u8d56\u4e8e\u4e3b\u673a\uff0c\u4e00\u65e6\u4e3b\u673a\u5b95\u673a\uff0c\u4ece\u673a\u4e5f\u65e0\u6cd5\u4f7f\u7528"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6d41\u7a0b\uff1a",(0,s.jsx)(n.img,{alt:"Master-Slave Process",src:a(9115).A+"",width:"1070",height:"495"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\ndetect[Slave \u63a2\u6d4b Master \u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6] --\x3e if{\u65e5\u5fd7\u6587\u4ef6\u662f\u5426\u66f4\u65b0} --\u504f\u79fb\u91cf\u76f8\u540c--\x3e detect\nif --\u504f\u79fb\u91cf\u4e0d\u540c--\x3e \nslave_request[Slave \u542f\u52a8I/O\u7ebf\u7a0b\uff0c\u5411 Master \u8bf7\u6c42\u504f\u79fb\u91cf\u5dee\u503c\u95f4\u7684\u6240\u6709\u6570\u636e] --\x3e \nmaster_response[Master \u542f\u52a8dump\u7ebf\u7a0b\uff0c\u63a8\u9001\u6570\u636e\u5230 Slave] --\x3e \nslave_update[Slave \u63a5\u6536\u5230\u6570\u636e\u540e\uff0c\u66f4\u65b0\u504f\u79fb\u91cf\u4e0e\u4e2d\u7ee7\u65e5\u5fd7\u6587\u4ef6\uff0c\u518d\u6302\u8d77I/O\u7ebf\u7a0b] --\x3e \nslave_replay[Slave \u542f\u52a8SQL\u7ebf\u7a0b\uff0c\u6839\u636e\u4e2d\u7ee7\u65e5\u5fd7\u5728\u6570\u636e\u5e93\u4e2d\u56de\u653e\uff0c\u5b8c\u6210\u540e\u6302\u8d77SQL\u7ebf\u7a0b] --\u7b49\u5f85\u4e0b\u4e00\u6b21\u88ab\u5524\u9192--\x3e if"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e3b\u5e93\u548c\u4ece\u5e93\u90fd\u9700\u8981\u8bb0\u5f55\u81ea\u8eab\u7684\u504f\u79fb\u91cf\uff0c\u4ee5\u4fbf\u4e8e\u540c\u6b65\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"\u65e5\u5fd7\u6587\u4ef6\u4e2d\u8bb0\u5f55\u7684\u662f\u4e3b\u5e93\u6240\u6267\u884c\u7684sql\u8bed\u53e5"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"12-mysql\u591a\u5b9e\u4f8b",children:"1.2. MySQL\u591a\u5b9e\u4f8b"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u591a\u5b9e\u4f8b\uff1a\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u540c\u65f6\u542f\u52a8\u591a\u4e2a\u6570\u636e\u5e93\uff08\u5b9e\u4f8b\uff09\uff0c\u4e0d\u9700\u8981\u5b89\u88c5\u591a\u4e2a\u6570\u636e\u5e93"}),"\n",(0,s.jsxs)(n.li,{children:["\u5b9e\u73b0\u65b9\u5f0f\uff1a\u4e3a\u5404\u4e2a\u6570\u636e\u5e93\u5b9e\u4f8b\u914d\u7f6e\u72ec\u7acb\u7684\u914d\u7f6e\u6587\u4ef6","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u521d\u59cb\u5316\u6570\u636e\u5e93\uff1a\u9700\u8981\u6307\u5b9a\u5b58\u653e\u6570\u636e\u7684\u76ee\u5f55","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"./mysqld --initialize-insecure --datadir=\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff1a",(0,s.jsx)(n.code,{children:"*.cnf"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u542f\u52a8\u670d\u52a1\uff1a\u9700\u8981\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"./mysqld_safe --defaults-file= &\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e ",(0,s.jsx)(n.strong,{children:"\u4e00\u4e3b\u591a\u4ece"}),"\uff1a","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"*.cnf"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",metastring:"showLineNumbers",children:"# \uff08\u4ec5\u4e3b\u670d\u52a1\u5668\u9700\u8981\u8be5\u914d\u7f6e\u9879\uff09\u542f\u7528\u4e3b\u670d\u52a1\u5668\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\nlog-bin=mysql-bin\nserver-id=3308\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4e3b\u670d\u52a1\u5668\u5ba2\u6237\u7aef\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",metastring:"showLineNumbers",children:"# \u521b\u5efa\u590d\u5236\u6570\u636e\u7684\u8d26\u53f7\u5e76\u6388\u6743\ngrant replication slave on *.* to 'copy_username'@'%' identified by 'password';\n\n# \u67e5\u770b\u4e3b\u670d\u52a1\u5668\u7684\u72b6\u6001\uff0cPosition\u521d\u59cb\u503c\u4e3a154\nshow master status;\n\n# \u91cd\u7f6e\u4e3b\u670d\u52a1\u5668\u7684\u72b6\u6001\nreset master;\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4ece\u670d\u52a1\u5668\u5ba2\u6237\u7aef\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",metastring:"showLineNumbers",children:"# \u67e5\u770b\u4ece\u670d\u52a1\u5668\u7684\u72b6\u6001\nreset slave status;\n\n# \u91cd\u7f6e\u4ece\u670d\u52a1\u5668\u7684\u72b6\u6001\nreset slave;\n\n# \u8bbe\u7f6e\u4ece\u670d\u52a1\u5668\u7684master\u670d\u52a1\u5668\nchange master to master_host='',master_port=,master_user='copy_username',master_password='password',master_log_file='mysql-bin.000001',master_log_pos=154;\n\n# \u5f00\u59cb\u6267\u884c\u590d\u5236\u547d\u4ee4\nstart slave;\n\n# \u68c0\u67e5\u4ece\u670d\u52a1\u5668\u590d\u5236\u529f\u80fd\u7684\u72b6\u6001\nshow slave status \\G;\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Slave_IO_Running"})," \u548c ",(0,s.jsx)(n.code,{children:"Slave_SQL_Running"})," \u5747\u4e3a ",(0,s.jsx)(n.code,{children:"YES"})," \u2192 \u4e3b\u4ece\u5173\u7cfb\u6b63\u5e38"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e ",(0,s.jsx)(n.strong,{children:"\u53cc\u4e3b\u53cc\u4ece"}),"\uff1a","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"*.cnf"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",metastring:"showLineNumbers",children:"# \uff08\u4ec5\u4e3b\u670d\u52a1\u5668\u9700\u8981\u8be5\u914d\u7f6e\u9879\uff09\u542f\u7528\u4e3b\u670d\u52a1\u5668\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\nlog-bin=mysql-bin\nserver-id=3308\n\n# \u4e3b\u952e\u81ea\u589e\u6b65\u957f\nauto_increment_increment=2\n# \u4e3b\u952e\u81ea\u589e\u8d77\u59cb\u503c\nauto_increment_offset=1\n# \u4e3b\u670d\u52a1\u5668\u4e4b\u95f4\u540c\u6b65\u6570\u636e\u65f6\u4f1a\u66f4\u65b0\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u670d\u52a1\u5668\u66f4\u65b0\u6570\u636e\nlog-slave-updates\n# \u6bcf\u63d0\u4ea41\u6b21\u4e8b\u52a1\uff0c\u6570\u636e\u5e93\u5c31\u4f1a\u628abinlog\u7f13\u5b58\u5237\u8fdb\u65e5\u5fd7\u6587\u4ef6\u4e2d\nsync_binlog=1\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["n\u53f0\u4e3b\u670d\u52a1\u5668\uff0c\u5219\u8bbe\u7f6e ",(0,s.jsx)(n.code,{children:"auto_increment_increment=n"})," \u2192 \u9632\u6b62\u4e3b\u670d\u52a1\u5668\u4e4b\u95f4\u5728\u590d\u5236\u6570\u636e\u65f6\u51fa\u73b0\u91cd\u590d\u7684\u81ea\u589e\u4e3b\u952e\u503c"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sync_binlog=0"}),"\uff1a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u6570\u636e\u5e93\u4e0d\u505afsync\u4e4b\u7c7b\u7684\u78c1\u76d8\u540c\u6b65\u6307\u4ee4\u5237\u65b0binlog_cache\u4e2d\u7684\u4fe1\u606f\u5230\u78c1\u76d8\uff0c\u800c\u662f\u8ba9Filesystem\u81ea\u884c\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u6765\u505a\u540c\u6b65\uff0c\u6216\u8005cache\u6ee1\u4e86\u4e4b\u540e\u624d\u540c\u6b65\u5230\u78c1\u76d8"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4e3b/\u4ece\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u547d\u4ee4\u540c ",(0,s.jsx)(n.strong,{children:"\u4e00\u4e3b\u591a\u4ece"})]}),"\n",(0,s.jsx)(n.li,{children:"\u4e3b\u952e\u4e3a\u81ea\u589e\u7c7b\u578b\u65f6\uff0c\u4e3b\u952e\u4f1a\u53d6\u5f53\u4e0b\u540c\u6b65\u5230\u7684\u6240\u6709\u6570\u636e\u4e2d\u7684\u6700\u5927\u503c\uff0c\u4e0e\u5f53\u524d\u8868\u7684\u81ea\u589e\u8d77\u59cb\u503c\u548c\u6b65\u957f\u4e00\u540c\u51b3\u5b9a\u6700\u65b0\u4e3b\u952e\u503c\uff08\u4e0d\u4e00\u5b9a\u4f1a\u6309\u7167\u8d77\u59cb\u503c\u5f00\u59cb\u9012\u589e \u2192 \u907f\u514d\u5f71\u54cd\u5df2\u6709\u7d22\u5f15\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-\u591a\u6570\u636e\u6e90",children:"2. \u591a\u6570\u636e\u6e90"}),"\n",(0,s.jsx)(n.h3,{id:"21-jdbc",children:"2.1. JDBC"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u7f16\u5199\u591a\u4e2a ",(0,s.jsx)(n.code,{children:"getConnection"}),"\uff0c\u5206\u522b\u8fde\u63a5\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5373\u53ef"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"22-hibernatessh",children:"2.2. Hibernate\uff08SSH\uff09"}),"\n",(0,s.jsx)(n.h3,{id:"23-mybatisssm",children:"2.3. Mybatis\uff08SSM\uff09"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Spring + Mybatis\uff1a","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e\u591a\u6570\u636e\u6e90\uff08\u9759\u6001\uff09\uff1a\u9700\u8981\u51c6\u5907\u591a\u5957Mapper\u6765\u9694\u79bb\u8bfb\u5199\u64cd\u4f5c\uff08\u5b58\u5728\u91cd\u590d\u4ee3\u7801\uff09\uff0c\u9700\u8981\u624b\u52a8\u5207\u6362\u4e3b\u4ece\u670d\u52a1\u5668\u6765\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u65e0\u6cd5\u81ea\u52a8\u8d1f\u8f7d\u5747\u8861\u548c\u6545\u969c\u8f6c\u79fb","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:"showLineNumbers",children:'\x3c!-- \u914d\u7f6e\u6570\u636e\u6e90 --\x3e\n<bean id="dataSourceId" class="com.alibaba.druid.pool.DruidDataSource">\n    <property name="url" value="jdbc:mysql://ip:port/database"/>\n    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>\n    <property name="username" value="username"/>\n    <property name="password" value="password"/>\n</bean>\n\n\x3c!-- \u914d\u7f6e\u8fde\u63a5\u5de5\u5382 --\x3e\n<bean id="sqlSessionFactoryBeanName" class="org.mybatis.spring.SqlSessionFactoryBean">\n    <property name="dataSource" ref="dataSourceId"/>\n</bean>\n\n\x3c!-- \u914d\u7f6emapper\u7684\u5305\u626b\u63cf --\x3e\n<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n    <property name="sqlSessionFactoryBeanName" value="sqlSessionFactoryBeanName"/>\n    <property name="basePackage" value="custom.mapper.mapperPackageName"/>\n</bean>\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e\u591a\u6570\u636e\u6e90\uff08\u52a8\u6001\uff09\uff1a\u9700\u8981\u81ea\u5b9a\u4e49\u52a8\u6001\u6570\u636e\u6e90\u7684\u7c7b\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e\u6570\u636e\u6e90\u503c\u6765\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u65e0\u6cd5\u81ea\u52a8\u8d1f\u8f7d\u5747\u8861\u548c\u6545\u969c\u8f6c\u79fb","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:"showLineNumbers",children:'\x3c!-- \u914d\u7f6e\u6570\u636e\u6e90 --\x3e\n<bean id="dataSourceId" class="com.alibaba.druid.pool.DruidDataSource">\n    <property name="url" value="jdbc:mysql://ip:port/database"/>\n    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>\n    <property name="username" value="username"/>\n    <property name="password" value="password"/>\n</bean>\n\n\x3c!-- \u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90 --\x3e\n<bean id="dynamicDataSourceId" class="custom.dynamic.DynamicDataSource">\n    <property name="targetDataSources">\n        <map>\n            <entry key="dataSourceKey" value-ref="dataSourceId"/>\n        </map>\n    </property>\n</bean>\n\n\x3c!-- \u914d\u7f6e\u8fde\u63a5\u5de5\u5382 --\x3e\n<bean id="sqlSessionFactoryBeanName" class="org.mybatis.spring.SqlSessionFactoryBean">\n    <property name="dataSource" ref="dynamicDataSourceId"/>\n</bean>\n\n\x3c!-- \u914d\u7f6emapper\u7684\u5305\u626b\u63cf --\x3e\n<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n    <property name="sqlSessionFactoryBeanName" value="sqlSessionFactoryBeanName"/>\n    <property name="basePackage" value="custom.mapper.mapperPackageName"/>\n</bean>\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["SpringBoot + Mybatis\uff1a","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e\u591a\u6570\u636e\u6e90\uff08\u9759\u6001\uff09\uff1a\u4ecd\u5b58\u5728\u4e0a\u8ff0\u95ee\u9898","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",metastring:"showLineNumbers",children:"spring.datasource.masterUrl=jdbc:mysql://ip:port/database\nspring.datasource.masterDriver=com.mysql.cj.jdbc.Driver\nspring.datasource.masterUsername=username\nspring.datasource.masterPassword=password\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'@Configuration\n@MapperScan(basePackages="custom.mapper.mapperPackageName", sqlSessionTemplateRef = "sqlSessionTemplateName")\npublic class CustomDataSource {\n    // \u81ea\u5b9a\u4e49\u5c5e\u6027\u7684\u6620\u5c04\u7c7b\n    @Autowired\n    private DataSourceConfigInfo dataSourceConfigInfo;\n\n    /** \u914d\u7f6e\u6570\u636e\u6e90\uff1a\n        <bean id="dataSourceId" class="com.alibaba.druid.pool.DruidDataSource">\n            <property name="url" value="jdbc:mysql://ip:port/database"/>\n            <property name="driverClassName" value="com.mysql.jdbc.Driver"/>\n            <property name="username" value="username"/>\n            <property name="password" value="password"/>\n        </bean>\n    */\n    @Bean\n    public DruidDataSource dataSourceId(){\n        DruidDataSource druidDataSource = new DruidDataSource();\n        druidDataSource.setUrl(dataSourceConfigInfo.getMasterUrl());\n        druidDataSource.setDriverClassName(dataSourceConfigInfo.getMasterDriver());\n        druidDataSource.setUsername(dataSourceConfigInfo.getMasterUsername());\n        druidDataSource.setPassword(dataSourceConfigInfo.getMasterPassword());\n        return druidDataSource;\n    }\n\n    /** \u914d\u7f6e\u8fde\u63a5\u5de5\u5382\uff1a\n        <bean id="sqlSessionFactoryBeanName" class="org.mybatis.spring.SqlSessionFactoryBean">\n            <property name="dataSource" ref="dataSourceId"/>\n        </bean>\n    */\n    @Bean\n    public SqlSessionFactoryBean sqlSessionFactoryBeanName(){\n        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();\n        sqlSessionFactoryBean.setDataSource(dataSourceId());\n        return sqlSessionFactoryBean;\n    }\n\n    /** \u914d\u7f6emapper\u7684\u5305\u626b\u63cf\uff1a\n        <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n            <property name="sqlSessionFactoryBeanName" value="sqlSessionFactoryBeanName"/>\n            <property name="basePackage" value="custom.mapper.mapperPackageName"/>\n        </bean>\n\n        \u6ce8\uff1a\u5728SpringBoot\u4e2d\uff0c\u9700\u8981 SqlSessionTemplate + @MapperScan \u914d\u5408\u5b9e\u73b0\n    */\n    @Bean\n    public SqlSessionTemplate sqlSessionTemplateName() throws Exception{\n        SqlSessionTemplate sqlSessionTemplate = new SqlSessionTemplate(sqlSessionFactoryBeanName().getObject());\n        return sqlSessionTemplate;\n    }\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u914d\u7f6e\u591a\u6570\u636e\u6e90\uff08\u52a8\u6001\uff09\uff1a\u4ecd\u5b58\u5728\u4e0a\u8ff0\u95ee\u9898","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",metastring:"showLineNumbers",children:"spring.datasource.masterUrl=jdbc:mysql://ip:port/database\nspring.datasource.masterDriver=com.mysql.cj.jdbc.Driver\nspring.datasource.masterUsername=username\nspring.datasource.masterPassword=password\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'@Configuration\n@MapperScan(basePackages="custom.mapper.mapperPackageName", sqlSessionTemplateRef = "sqlSessionTemplateName")\npublic class CustomDataSource {\n    // \u81ea\u5b9a\u4e49\u5c5e\u6027\u7684\u6620\u5c04\u7c7b\n    @Autowired\n    private DataSourceConfigInfo dataSourceConfigInfo;\n\n    /** \u914d\u7f6e\u6570\u636e\u6e90\uff1a\n        <bean id="dataSourceId" class="com.alibaba.druid.pool.DruidDataSource">\n            <property name="url" value="jdbc:mysql://ip:port/database"/>\n            <property name="driverClassName" value="com.mysql.jdbc.Driver"/>\n            <property name="username" value="username"/>\n            <property name="password" value="password"/>\n        </bean>\n    */\n    @Bean\n    public DruidDataSource dataSourceId(){\n        DruidDataSource druidDataSource = new DruidDataSource();\n        druidDataSource.setUrl(dataSourceConfigInfo.getMasterUrl());\n        druidDataSource.setDriverClassName(dataSourceConfigInfo.getMasterDriver());\n        druidDataSource.setUsername(dataSourceConfigInfo.getMasterUsername());\n        druidDataSource.setPassword(dataSourceConfigInfo.getMasterPassword());\n        return druidDataSource;\n    }\n\n    /** \u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90\uff1a\n        <bean id="dynamicDataSourceId" class="custom.dynamic.DynamicDataSource">\n            <property name="targetDataSources">\n                <map>\n                    <entry key="dataSourceKey" value-ref="dataSourceId"/>\n                </map>\n            </property>\n        </bean>\n    */\n    @Bean\n    public DynamicDataSource dynamicDataSourceId(){\n        DynamicDataSource dynamicDataSource = new DynamicDataSource();\n        Map<Object, Object> targetDataSources = new ConcurrentHashMap<Object, Object>();\n        targetDataSources.put(DynamicDataSource.DATASOURCE_KEY, dataSourceId());\n        dynamicDataSource.setTargetDataSources(targetDataSources);\n        return dynamicDataSource;\n    }\n\n    /** \u914d\u7f6e\u8fde\u63a5\u5de5\u5382\uff1a\n        <bean id="sqlSessionFactoryBeanName" class="org.mybatis.spring.SqlSessionFactoryBean">\n            <property name="dataSource" ref="dynamicDataSourceId"/>\n        </bean>\n    */\n    @Bean\n    public SqlSessionFactoryBean sqlSessionFactoryBeanName(){\n        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();\n        sqlSessionFactoryBean.setDataSource(dynamicDataSourceId());\n        return sqlSessionFactoryBean;\n    }\n\n    /** \u914d\u7f6emapper\u7684\u5305\u626b\u63cf\uff1a\n        <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n            <property name="sqlSessionFactoryBeanName" value="sqlSessionFactoryBeanName"/>\n            <property name="basePackage" value="custom.mapper.mapperPackageName"/>\n        </bean>\n\n        \u6ce8\uff1a\u5728SpringBoot\u4e2d\uff0c\u9700\u8981 SqlSessionTemplate + @MapperScan \u914d\u5408\u5b9e\u73b0\n    */\n    @Bean\n    public SqlSessionTemplate sqlSessionTemplateName() throws Exception{\n        SqlSessionTemplate sqlSessionTemplate = new SqlSessionTemplate(sqlSessionFactoryBeanName().getObject());\n        return sqlSessionTemplate;\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4978(e,n,a){a.d(n,{A:()=>s});const s=a.p+"assets/images/7.1.1.1-master-n-slave-0f5975d6d8f2a1b21286e415339e2c2f.jpg"},9730(e,n,a){a.d(n,{A:()=>s});const s=a.p+"assets/images/7.1.2.2-master-2-slave-1c7c05423ee92d1b3674f87cdf43fc79.jpg"},9115(e,n,a){a.d(n,{A:()=>s});const s=a.p+"assets/images/7.1.3.master-slave-process-8d9880cde4016ec715a3247fc448fd1e.jpg"},8453(e,n,a){a.d(n,{R:()=>t,x:()=>o});var s=a(6540);const r={},i=s.createContext(r);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);